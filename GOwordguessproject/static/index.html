<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplayer Drawing Game</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            font-family: Arial, sans-serif;
        }
        #drawcanvas {
            border: 1px solid #000;
        }
        #current-word {
            font-size: 1.5rem;
            font-weight: bold;
        }
        #guess {
            outline: none;
            padding: 0.5rem;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <!-- Canvas for Drawing -->
    <canvas id="drawcanvas" width="500" height="500"></canvas>

    <!-- Color Picker -->
    <input type="color" id="colorpicker" value="#000000">

    <!-- Input Field for Guessing -->
    <input type="text" id="guess" placeholder="Enter your guess here">

    <!-- Clear Button -->
    <button id="clear">Clear</button>

    <!-- Current Word to Draw Display -->
    <div id="current-word">Word to Draw: </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const canvas = document.getElementById('drawcanvas');
            const ctx = canvas.getContext('2d');
            const ws = new WebSocket("ws://localhost:8080/ws/");
            let currentColor = "#000000";
            let drawing = false;
            let lastX = 0;
            let lastY = 0;

            // WebSocket on open
            ws.onopen = function () {
                console.log("WebSocket connected");
            }

            // WebSocket on message
            ws.onmessage = function (event) {
                let message = JSON.parse(event.data);

                switch (message.type) {
                    case "drawing":
                        // Handle drawing message from another player
                        if (message.color) {
                            ctx.strokeStyle = message.color;
                        } else {
                            ctx.strokeStyle = "#000000"; // Default to black if no color provided
                        }
                        ctx.beginPath();
                        ctx.moveTo(message.x0, message.y0);
                        ctx.lineTo(message.x1, message.y1);
                        ctx.stroke();
                        break;

                    case "word":
                        // Handle word message to be displayed only to the drawer
                        const wordElement = document.getElementById('current-word');
                        console.log("Hello")
                        wordElement.textContent = "Word to Draw: " + message.content;
                        console.log("Received word to draw:", message.content);
                        break;

                    case "guess":
                        // Log guesses for simplicity, or add a GUI update here
                        console.log(`${message.sender} guessed: ${message.content}`);
                        break;

                    default:
                        console.log("Unknown message type:", message);
                }
            }

            // Color Picker Event
            document.getElementById('colorpicker').addEventListener('change', function (e) {
                currentColor = e.target.value;
                ctx.strokeStyle = currentColor;
            });

            // Clear Button Event
            document.getElementById('clear').addEventListener('click', function () {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            });

            // Mouse Events for Drawing
            canvas.addEventListener('mousedown', (e) => {
                drawing = true;
                lastX = e.offsetX;
                lastY = e.offsetY;
            });

            canvas.addEventListener('mousemove', (e) => {
                if (!drawing) return;

                // Draw on canvas locally
                ctx.strokeStyle = currentColor;
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();

                // Send drawing data to server
                let drawingMessage = {
                    type: "drawing",
                    x0: lastX,
                    y0: lastY,
                    x1: e.offsetX,
                    y1: e.offsetY,
                    color: currentColor
                };
                ws.send(JSON.stringify(drawingMessage));

                lastX = e.offsetX;
                lastY = e.offsetY;
            });

            canvas.addEventListener('mouseup', () => drawing = false);
            canvas.addEventListener('mouseout', () => drawing = false);

            // Handle Player Guessing
            const guessInput = document.getElementById('guess');
            guessInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter' && guessInput.value.trim() !== '') {
                    // Send guess to server
                    let guessMessage = {
                        type: "guess",
                        content: guessInput.value,
                        sender: "Player" // Use player name/ID in a real scenario
                    };
                    ws.send(JSON.stringify(guessMessage));
                    guessInput.value = ""; // Clear the input field after sending
                }
            });
        });
    </script>
</body>
</html>
